<% content_for :title, "Button Management Test Suite" %>

<div class="container-fluid" data-controller="button-test">
  <div class="row">
    <div class="col-12">
      <div class="d-flex justify-content-between align-items-center mb-4">
        <div>
          <h1 class="h3 mb-0">
            <i class="fas fa-vial me-2"></i>Button & Request Manager Test Page
          </h1>
          <p class="text-muted mb-0">Test the button management system and request handling</p>
        </div>
        
        <div class="d-flex align-items-center gap-3">
          <div class="text-end">
            <small class="text-muted d-block">Request Manager</small>
            <span id="request-manager-status" class="badge bg-secondary">Checking...</span>
          </div>
          <div class="text-end">
            <small class="text-muted d-block">Active Requests</small>
            <span id="active-requests-count" class="badge bg-success">0</span>
          </div>
          <div class="text-end">
            <small class="text-muted d-block">Loading Buttons</small>
            <span id="loading-buttons-count" class="badge bg-success">0</span>
          </div>
        </div>
      </div>

      <!-- System Status Overview -->
      <div class="row mb-4">
        <div class="col-12">
          <div class="card border-0 shadow-sm">
            <div class="card-header bg-primary text-white">
              <h5 class="mb-0">
                <i class="fas fa-info-circle me-2"></i>System Status Overview
              </h5>
            </div>
            <div class="card-body">
              <div class="row">
                <div class="col-md-3">
                  <div class="text-center">
                    <div class="h4 text-primary mb-1" id="active-requests-count">0</div>
                    <small class="text-muted">Active Requests</small>
                  </div>
                </div>
                <div class="col-md-3">
                  <div class="text-center">
                    <div class="h4 text-warning mb-1" id="loading-buttons-count">0</div>
                    <small class="text-muted">Loading Buttons</small>
                  </div>
                </div>
                <div class="col-md-3">
                  <div class="text-center">
                    <div class="h4 text-success mb-1" id="completed-requests-count">0</div>
                    <small class="text-muted">Completed Today</small>
                  </div>
                </div>
                <div class="col-md-3">
                  <div class="text-center">
                    <div class="h4 text-info mb-1" id="avg-response-time">0ms</div>
                    <small class="text-muted">Avg Response Time</small>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Basic Button Tests -->
      <div class="row mb-4">
        <div class="col-12">
          <div class="card border-0 shadow-sm">
            <div class="card-header bg-success text-white">
              <h5 class="mb-0">
                <i class="fas fa-play me-2"></i>Basic Button Tests
              </h5>
            </div>
            <div class="card-body">
              <div class="row">
                <div class="col-md-4">
                  <h6>Standard Buttons</h6>
                  <div class="d-grid gap-2">
                    <button class="btn btn-primary" 
                            data-url="/api/test/fast-request" 
                            data-request="true"
                            data-analytics-track="test_fast_button">
                      <i class="fas fa-bolt me-2"></i>Fast Request (0.5s)
                    </button>
                    <button class="btn btn-warning" 
                            data-url="/api/test/medium-request" 
                            data-request="true"
                            data-analytics-track="test_medium_button">
                      <i class="fas fa-clock me-2"></i>Medium Request (2s)
                    </button>
                    <button class="btn btn-danger" 
                            data-url="/api/test/slow-request" 
                            data-request="true"
                            data-analytics-track="test_slow_button">
                      <i class="fas fa-hourglass-half me-2"></i>Slow Request (5s)
                    </button>
                  </div>
                </div>
                
                <div class="col-md-4">
                  <h6>Form Submissions</h6>
                  <div class="d-grid gap-2">
                    <form data-url="/api/test/form-submit" 
                          data-request="true"
                          data-analytics-track="test_form_submit"
                          class="d-grid gap-2">
                      <input type="text" class="form-control" placeholder="Test input" value="Sample data">
                      <button type="submit" class="btn btn-outline-primary">
                        <i class="fas fa-paper-plane me-2"></i>Submit Form
                      </button>
                    </form>
                    
                    <form data-url="/api/test/form-submit-slow" 
                          data-request="true"
                          data-analytics-track="test_form_submit_slow"
                          class="d-grid gap-2">
                      <input type="text" class="form-control" placeholder="Slow form" value="Slow data">
                      <button type="submit" class="btn btn-outline-warning">
                        <i class="fas fa-hourglass me-2"></i>Slow Form (3s)
                      </button>
                    </form>
                  </div>
                </div>
                
                <div class="col-md-4">
                  <h6>Navigation Tests</h6>
                  <div class="d-grid gap-2">
                    <a href="<%= dashboard_path %>?test=nav1" 
                       class="btn btn-outline-success" 
                       data-request="true"
                       data-analytics-track="test_nav_dashboard">
                      <i class="fas fa-tachometer-alt me-2"></i>Go to Dashboard
                    </a>
                    <a href="<%= analytics_demographics_path %>?test=nav2" 
                       class="btn btn-outline-info" 
                       data-request="true"
                       data-analytics-track="test_nav_analytics">
                      <i class="fas fa-chart-bar me-2"></i>Go to Analytics
                    </a>
                    <a href="<%= settings_path %>?test=nav3" 
                       class="btn btn-outline-secondary" 
                       data-request="true"
                       data-analytics-track="test_nav_settings">
                      <i class="fas fa-cog me-2"></i>Go to Settings
                    </a>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Notification System Tests -->
      <div class="row mb-4">
        <div class="col-12">
          <div class="card border-0 shadow-sm">
            <div class="card-header bg-info text-white">
              <h5 class="mb-0">
                <i class="fas fa-bell me-2"></i>Notification System Tests
              </h5>
            </div>
            <div class="card-body">
              <div class="row">
                <div class="col-md-6">
                  <h5>Basic Notifications</h5>
                  <div class="d-grid gap-2">
                    <button class="btn btn-success" 
                            data-action="click->button-test#showTestNotification"
                            data-button-test-message-param="Operation completed successfully!"
                            data-button-test-type-param="success">
                      <i class="fas fa-check me-2"></i>Success Notification
                    </button>
                    <button class="btn btn-danger" 
                            data-action="click->button-test#showTestNotification"
                            data-button-test-message-param="Something went wrong. Please try again."
                            data-button-test-type-param="error">
                      <i class="fas fa-exclamation-triangle me-2"></i>Error Notification
                    </button>
                    <button class="btn btn-warning" 
                            data-action="click->button-test#showTestNotification"
                            data-button-test-message-param="Please review your settings before continuing."
                            data-button-test-type-param="warning">
                      <i class="fas fa-exclamation-circle me-2"></i>Warning Notification
                    </button>
                    <button class="btn btn-info" 
                            data-action="click->button-test#showTestNotification"
                            data-button-test-message-param="Your account has been updated with new features."
                            data-button-test-type-param="info">
                      <i class="fas fa-info-circle me-2"></i>Info Notification
                    </button>
                  </div>
                </div>
                
                <div class="col-md-6">
                  <h5>Advanced Features</h5>
                  <div class="d-grid gap-2">
                    <button class="btn btn-outline-primary" 
                            data-action="click->button-test#showMultipleNotifications">
                      <i class="fas fa-layer-group me-2"></i>Multiple Notifications
                    </button>
                    <button class="btn btn-outline-secondary" 
                            data-action="click->button-test#showLongNotification">
                      <i class="fas fa-align-left me-2"></i>Long Message Test
                    </button>
                    <button class="btn btn-outline-warning" 
                            data-action="click->button-test#showCustomDuration">
                      <i class="fas fa-clock me-2"></i>Custom Duration (10s)
                    </button>
                    <button class="btn btn-outline-danger" 
                            data-action="click->button-test#clearAllNotifications">
                      <i class="fas fa-trash me-2"></i>Clear All Notifications
                    </button>
                  </div>
                </div>
              </div>
              
              <div class="mt-3">
                <small class="text-muted">
                  <i class="fas fa-lightbulb me-1"></i>
                  <strong>Features to test:</strong> Hover to pause auto-dismiss, glassmorphism effects in dark mode, 
                  progress bars, smooth animations, and responsive positioning.
                </small>
              </div>
            </div>
          </div>
        </div>
      </div>

      <hr>

      <!-- Stress Test Section -->
      <div class="row mb-4">
        <div class="col-12">
          <h4><i class="fas fa-dumbbell me-2"></i>Stress Tests</h4>
          
          <div class="mb-3">
            <h5>Rapid Navigation Test</h5>
            <p class="text-muted">Click these quickly to test navigation cancellation:</p>
            <div class="btn-group" role="group">
              <a href="<%= dashboard_path %>?test=rapid1" 
                 class="btn btn-sm btn-outline-primary" 
                 data-request="true">Page 1</a>
              <a href="<%= analytics_demographics_path %>?test=rapid2" 
                 class="btn btn-sm btn-outline-primary" 
                 data-request="true">Page 2</a>
              <a href="<%= settings_path %>?test=rapid3" 
                 class="btn btn-sm btn-outline-primary" 
                 data-request="true">Page 3</a>
              <a href="<%= dashboard_path %>?test=rapid4" 
                 class="btn btn-sm btn-outline-primary" 
                 data-request="true">Page 4</a>
            </div>
          </div>

          <div class="mb-3">
            <h5>Multiple Request Test</h5>
            <p class="text-muted">These simulate different types of concurrent requests:</p>
            <div class="btn-group" role="group">
              <button class="btn btn-sm btn-warning" 
                      data-url="/api/test/slow-request" 
                      data-request="true"
                      data-analytics-track="test_slow_request">
                Slow Request (5s)
              </button>
              <button class="btn btn-sm btn-info" 
                      data-url="/api/test/medium-request" 
                      data-request="true"
                      data-analytics-track="test_medium_request">
                Medium Request (2s)
              </button>
              <button class="btn btn-sm btn-success" 
                      data-url="/api/test/fast-request" 
                      data-request="true"
                      data-analytics-track="test_fast_request">
                Fast Request (0.5s)
              </button>
            </div>
          </div>
        </div>
      </div>

      <hr>

      <!-- Control Panel -->
      <div class="row">
        <div class="col-12">
          <h4><i class="fas fa-sliders-h me-2"></i>Control Panel</h4>
          
          <div class="btn-group me-3" role="group">
            <button class="btn btn-outline-success" 
                    data-action="click->button-test#resetAllStates">
              <i class="fas fa-refresh me-2"></i>Reset All States
            </button>
            <button class="btn btn-outline-info" 
                    data-action="click->button-test#showSystemStats">
              <i class="fas fa-info-circle me-2"></i>Show System Stats
            </button>
            <button class="btn btn-outline-warning" 
                    data-action="click->button-test#simulateError">
              <i class="fas fa-exclamation-triangle me-2"></i>Simulate Error
            </button>
            <button class="btn btn-outline-primary" 
                    data-action="click->button-test#showDebugCommands">
              <i class="fas fa-terminal me-2"></i>Debug Commands
            </button>
          </div>

          <div class="mt-3">
            <h6>Test Results Log</h6>
            <div id="test-log" class="border rounded p-3 bg-light log-container-monospace" data-button-test-target="log">
              <div class="text-muted">Test log initialized. Click buttons above to see results...</div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>

<style>
  .btn.loading {
    position: relative;
    pointer-events: none;
    opacity: 0.8;
  }
  
  .btn.disabled {
    cursor: not-allowed;
  }
  
  .notification {
    position: fixed;
    top: 20px;
    right: 20px;
    z-index: 9999;
    max-width: 400px;
    padding: 1rem;
    border-radius: 8px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
    transform: translateX(100%) scale(0.9);
    opacity: 0;
    transition: all 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55);
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.2);
  }
  
  .notification.show {
    transform: translateX(0) scale(1);
    opacity: 1;
  }
  
  .notification-success {
    background: linear-gradient(135deg, #28a745, #20c997);
    color: white;
  }
  
  .notification-error {
    background: linear-gradient(135deg, #dc3545, #fd7e14);
    color: white;
  }
  
  .notification-warning {
    background: linear-gradient(135deg, #ffc107, #fd7e14);
    color: #212529;
  }
  
  .notification-info {
    background: linear-gradient(135deg, #17a2b8, #6f42c1);
    color: white;
  }
  
  .notification-close {
    position: absolute;
    top: 8px;
    right: 8px;
    background: none;
    border: none;
    color: inherit;
    font-size: 18px;
    cursor: pointer;
    opacity: 0.7;
    transition: opacity 0.2s;
  }
  
  .notification-close:hover {
    opacity: 1;
  }
  
  .log-container-monospace {
    font-family: 'Courier New', monospace;
    font-size: 0.875rem;
    max-height: 300px;
    overflow-y: auto;
    background: #f8f9fa;
    border: 1px solid #dee2e6;
  }
  
  .log-container-monospace div {
    margin-bottom: 0.25rem;
    padding: 0.125rem 0;
  }
  
  .dark-mode .log-container-monospace {
    background: #2d3748;
    border-color: #4a5568;
    color: #e2e8f0;
  }
  
  .dark-mode .notification {
    backdrop-filter: blur(10px);
    border: 1px solid rgba(255, 255, 255, 0.1);
  }
</style> 