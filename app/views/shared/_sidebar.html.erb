<!-- Shared Sidebar Component -->
<div class="col-md-2 d-md-block bg-light sidebar" id="sidebar">
  <div class="sidebar-sticky">
    <ul class="nav flex-column">
      <li class="nav-item">
        <a class="nav-link <%= 'active' if current_page?(dashboard_path) || request.path == "/dashboard" || request.path == "/" %>" href="<%= dashboard_path %>">
          <i class="fas fa-tachometer-alt"></i>
          Dashboard
        </a>
      </li>
      <li class="nav-item">
        <a class="nav-link <%= 'active' if current_page?(subscriptions_path) %>" href="<%= subscriptions_path %>">
          <i class="fas fa-link"></i>
          Linked Accounts
        </a>
      </li>
      <li class="nav-item">
        <a class="nav-link <%= 'active' if request.path.start_with?('/videos') %>" href="<%= videos_path %>">
          <i class="fas fa-video"></i>
          Videos
        </a>
      </li>
      <li class="nav-item">
        <a class="nav-link <%= 'active' if request.path.start_with?('/analytics') %>" href="<%= analytics_demographics_path %>">
          <i class="fas fa-chart-bar"></i>
          Analytics
        </a>
      </li>
      <li class="nav-item">
        <a class="nav-link" href="#" onclick="showComingSoon('Revenue'); return false;">
          <i class="fas fa-dollar-sign"></i>
          Revenue
        </a>
      </li>
      <li class="nav-item">
        <a class="nav-link <%= 'active' if current_page?(settings_path) %>" href="<%= settings_path %>">
          <i class="fas fa-cog"></i>
          Settings
        </a>
      </li>
      
      <!-- Platform Selector for Sidebar -->
      <li class="nav-item mt-4">
        <h6 class="sidebar-heading d-flex justify-content-between align-items-center px-3 mt-4 mb-1 text-muted">
          <span>Platforms</span>
        </h6>
      </li>
      
      <!-- All Platforms option -->
      <li class="nav-item">
        <% if current_page?(dashboard_path) || request.path == "/dashboard" || request.path == "/" %>
          <!-- Dashboard specific platform links with AJAX and time window support -->
          <a class="nav-link <%= defined?(@selected_platform) && @selected_platform.blank? ? 'active' : '' %>" 
             href="<%= dashboard_path(time_window: defined?(@selected_time_window) ? @selected_time_window : nil) %>" 
             data-platform="all" 
             data-action="click->button#switchPlatform">
            <i class="fas fa-globe"></i>
            All Platforms
          </a>
        <% elsif request.path.start_with?('/analytics') %>
          <a class="nav-link <%= defined?(@selected_platform) && @selected_platform == 'all' ? 'active' : '' %>" 
             href="<%= analytics_demographics_path(platform: 'all') %>">
            <i class="fas fa-layer-group"></i>
            All Platforms
          </a>
        <% elsif request.path.start_with?('/videos') %>
          <a class="nav-link <%= defined?(@selected_platform) && @selected_platform == 'all' ? 'active' : '' %>" 
             href="<%= videos_path(platform: 'all') %>">
            <i class="fas fa-layer-group"></i>
            All Platforms
          </a>
        <% else %>
          <a class="nav-link" href="<%= dashboard_path %>">
            <i class="fas fa-layer-group"></i>
            All Platforms
          </a>
        <% end %>
      </li>
      
      <!-- Individual Platform Links -->
      <% 
        # Get available platforms based on the context
        if defined?(@available_platforms) && @available_platforms.any?
          platforms = @available_platforms
        elsif user_signed_in?
          platforms = current_user.subscriptions.active.distinct.pluck(:platform)
        else
          platforms = []
        end
      %>
      
      <% if platforms.any? %>
        <% platforms.each do |platform| %>
          <li class="nav-item">
            <% if current_page?(dashboard_path) || request.path == "/dashboard" || request.path == "/" %>
              <!-- Dashboard specific platform links with AJAX and time window support -->
              <a class="nav-link <%= defined?(@selected_platform) && @selected_platform == platform ? 'active' : '' %>" 
                 href="<%= dashboard_path(platform: platform, time_window: defined?(@selected_time_window) ? @selected_time_window : nil) %>" 
                 data-platform="<%= platform %>" 
                 data-action="click->button#switchPlatform">
            <% elsif request.path.start_with?('/analytics') %>
              <a class="nav-link <%= defined?(@selected_platform) && @selected_platform == platform ? 'active' : '' %>" 
                 href="<%= analytics_demographics_path(platform: platform) %>">
            <% elsif request.path.start_with?('/videos') %>
              <a class="nav-link <%= defined?(@selected_platform) && @selected_platform == platform ? 'active' : '' %>" 
                 href="<%= videos_path(platform: platform) %>">
            <% else %>
              <a class="nav-link" href="<%= dashboard_path(platform: platform) %>">
            <% end %>
              <% case platform %>
              <% when 'tiktok' %>
                <i class="fab fa-tiktok"></i>
              <% when 'youtube' %>
                <i class="fab fa-youtube"></i>
              <% when 'instagram' %>
                <i class="fab fa-instagram"></i>
              <% when 'facebook' %>
                <i class="fab fa-facebook"></i>
              <% when 'twitter' %>
                <i class="fab fa-twitter"></i>
              <% when 'linkedin' %>
                <i class="fab fa-linkedin"></i>
              <% when 'twitch' %>
                <i class="fab fa-twitch"></i>
              <% else %>
                <i class="fas fa-video"></i>
              <% end %>
              <%= platform&.capitalize || 'Unknown' %>
            </a>
          </li>
        <% end %>
      <% else %>
        <!-- Show placeholder platforms if no subscriptions -->
        <li class="nav-item">
          <a class="nav-link disabled text-muted" href="#" onclick="showConnectPrompt('TikTok'); return false;">
            <i class="fab fa-tiktok"></i>
            TikTok
            <small class="d-block">Not connected</small>
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link disabled text-muted" href="#" onclick="showConnectPrompt('YouTube'); return false;">
            <i class="fab fa-youtube"></i>
            YouTube
            <small class="d-block">Not connected</small>
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link disabled text-muted" href="#" onclick="showConnectPrompt('Instagram'); return false;">
            <i class="fab fa-instagram"></i>
            Instagram
            <small class="d-block">Not connected</small>
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link disabled text-muted" href="#" onclick="showConnectPrompt('Facebook'); return false;">
            <i class="fab fa-facebook"></i>
            Facebook
            <small class="d-block">Not connected</small>
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link disabled text-muted" href="#" onclick="showConnectPrompt('Twitter'); return false;">
            <i class="fab fa-twitter"></i>
            Twitter
            <small class="d-block">Not connected</small>
          </a>
        </li>
      <% end %>
    </ul>
  </div>
</div>

<script>
  // Helper functions for sidebar interactions
  function showComingSoon(feature) {
    if (window.notificationController) {
      window.notificationController.showNotification(`${feature} feature coming soon!`, 'info');
    } else {
      alert(`${feature} feature coming soon!`);
    }
  }
  
  function showConnectPrompt(platform) {
    if (window.notificationController) {
      window.notificationController.showNotification(`Connect your ${platform} account to view platform-specific data.`, 'info');
    } else {
      alert(`Connect your ${platform} account to view platform-specific data.`);
    }
  }
</script> 