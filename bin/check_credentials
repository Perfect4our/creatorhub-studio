#!/usr/bin/env ruby

require_relative '../config/environment'

puts "ğŸ” Checking Encrypted Credentials Configuration"
puts "=" * 50

begin
  credentials = Rails.application.credentials
  
  # Check YouTube credentials
  puts "\nğŸ“º YouTube API Configuration:"
  if credentials.youtube
    puts "  âœ… YouTube section found"
    puts "  ğŸ“ API Key: #{credentials.youtube.api_key ? 'âœ… Present' : 'âŒ Missing'}"
    puts "  ğŸ“ Client ID: #{credentials.youtube.client_id ? 'âœ… Present' : 'âŒ Missing'}"
    puts "  ğŸ“ Client Secret: #{credentials.youtube.client_secret ? 'âœ… Present' : 'âŒ Missing'}"
    
    if credentials.youtube.api_key && credentials.youtube.client_id && credentials.youtube.client_secret
      puts "  ğŸ‰ All YouTube credentials configured!"
    else
      puts "  âš ï¸  Some YouTube credentials missing"
    end
  else
    puts "  âŒ No YouTube section found in credentials"
  end
  
  # Check other platform credentials
  platforms = [:tiktok, :instagram, :twitter, :facebook, :linkedin, :twitch, :stripe, :posthog]
  
  puts "\nğŸŒ Other Platform Credentials:"
  platforms.each do |platform|
    if credentials.public_send(platform)
      puts "  âœ… #{platform.to_s.titleize}: Configured"
    else
      puts "  âŒ #{platform.to_s.titleize}: Not configured"
    end
  end
  
  puts "\nğŸ” Environment Fallbacks:"
  puts "  YOUTUBE_API_KEY: #{ENV['YOUTUBE_API_KEY'] ? 'âœ… Set' : 'âŒ Not set'}"
  puts "  YOUTUBE_CLIENT_ID: #{ENV['YOUTUBE_CLIENT_ID'] ? 'âœ… Set' : 'âŒ Not set'}"
  puts "  YOUTUBE_CLIENT_SECRET: #{ENV['YOUTUBE_CLIENT_SECRET'] ? 'âœ… Set' : 'âŒ Not set'}"
  
  puts "\n" + "=" * 50
  puts "ğŸ”§ To edit credentials: EDITOR=\"code --wait\" rails credentials:edit"
  puts "ğŸ“š Setup guide: config/credentials_setup_guide.md"
  
rescue => e
  puts "âŒ Error reading credentials: #{e.message}"
  puts "\nPossible issues:"
  puts "- Missing master.key file"
  puts "- Incorrect RAILS_MASTER_KEY environment variable"
  puts "- Corrupted credentials file"
  puts "\nTry: rails credentials:edit to regenerate"
end 